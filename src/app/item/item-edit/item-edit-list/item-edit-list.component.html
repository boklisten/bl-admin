

<div class="row" *ngIf="temp.length > 0">
	<div class="col-12 mb-3">
		<button class="btn btn-sm mr-1" [ngClass]="{'btn-outline-success': selected.length > 0, 'btn-outline-secondary': selected.lenght <= 0}" [disabled]="selected.length <= 0" *ngIf="!autoUpdate" (click)="uploadSelected()">
			Upload selected
		</button>
		<button class="btn btn-sm" [ngClass]="{'btn-outline-secondary': selected.length > 0}" [disabled]="selected.length <= 0" (click)="onDownloadSelected()">
			Download selected
		</button>
	</div>
</div>

<div class="row">
	<div class="col-12">
		<div class="input-group mb-3" *ngIf="temp.length > 0">

            <input
                type='text'
				class="form-control"
                placeholder='Filter by title or isbn'
                (keyup)='updateFilter($event)'
            />
			<div class="input-group-append">
				<span class="input-group-text">
					<fa-icon [icon]="'filter'"></fa-icon>
				</span>
			</div>
		</div>
	</div>
</div>


<div class="row">
	<div class="col-12">
		<ngx-datatable
			#itemEditTable
			class="bootstrap"
			[headerHeight]="50"
			[rowHeight]="'auto'"
			[rows]="items"
			[columnMode]="'force'"
			[columns]="columns"
			[selected]="selected"
			[selectionType]="'checkbox'"
			(select)='onSelect($event)'>


			<ngx-datatable-column
				[width]="30"
				[sortable]="false"
				[canAutoResize]="false"
				[draggable]="false"
				[resizeable]="false"
				[frozenLeft]="true">
				<ng-template ngx-datatable-header-template let-value="value" let-allRowsSelected="allRowsSelected" let-selectFn="selectFn">
					<input type="checkbox" [checked]="allRowsSelected" (change)="selectFn(!allRowsSelected)"/>
				</ng-template>
				<ng-template ngx-datatable-cell-template let-value="value" let-isSelected="isSelected" let-onCheckboxChangeFn="onCheckboxChangeFn">
					<input type="checkbox" [checked]="isSelected" (change)="onCheckboxChangeFn($event)"/>
				</ng-template>
			</ngx-datatable-column>

			<ngx-datatable-column name="id" [frozenLeft]="true">
                <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value" let-row="row">
                    <span>
						{{value}}
                    </span>
                </ng-template>
            </ngx-datatable-column>

            <ngx-datatable-column name="title">
                <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value" let-row="row">
					<span
						title="Double click to edit"
						(dblclick)="editing[rowIndex + 'title'] = true"
						*ngIf="!editing[rowIndex + 'title']">
						{{value}}
                    </span>
                    <input
                        autofocus
                        (blur)="updateValue($event.target.value, 'title', rowIndex)"
						(keyup.enter)="updateValue($event.target.value, 'title', rowIndex)"
                        *ngIf="editing[rowIndex + 'title']"
                        type="text"
						class="form-control"
                        [value]="value"/>
                </ng-template>
            </ngx-datatable-column>


            <ngx-datatable-column name="price">
                <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value" let-row="row">
					<span
						title="Double click to edit"
						(dblclick)="editing[rowIndex + 'price'] = true"
						*ngIf="!editing[rowIndex + 'price']">
						{{value}}
                    </span>
                    <input
                        autofocus
                        (blur)="updateValue($event.target.value, 'price', rowIndex)"
						(keyup.enter)="updateValue($event.target.value, 'price', rowIndex)"
                        *ngIf="editing[rowIndex + 'price']"
                        type="text"
						class="form-control"
                        [value]="value"/>
                </ng-template>
            </ngx-datatable-column>

            <ngx-datatable-column name="rent" [maxWidth]="100">
                <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value" let-row="row">
                    <span>
                        <button class="btn btn-sm" [ngClass]="{'btn-outline-secondary': !value, 'btn-secondary': value}" (click)="updateValue(!value, 'rent', rowIndex)">
                            <fa-icon [icon]="'check'" class="mr-2" *ngIf="value"></fa-icon> Rent
                        </button>
                    </span>
                </ng-template>
            </ngx-datatable-column>

			<ngx-datatable-column name="sell" [maxWidth]="100">
                <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value" let-row="row">
                    <span>
                        <button class="btn btn-sm" [ngClass]="{'btn-outline-secondary': !value, 'btn-secondary': value}" (click)="updateValue(!value, 'sell', rowIndex)">
                            <fa-icon [icon]="'check'" class="mr-2" *ngIf="value"></fa-icon> Sell
                        </button>
                    </span>
                </ng-template>
            </ngx-datatable-column>

			<ngx-datatable-column name="buy" [maxWidth]="100">
                <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value" let-row="row">
                    <span>
                        <button class="btn btn-sm" [ngClass]="{'btn-outline-secondary': !value, 'btn-secondary': value}" (click)="updateValue(!value, 'buy', rowIndex)">
                            <fa-icon [icon]="'check'" class="mr-2" *ngIf="value"></fa-icon> Buy
                        </button>
                    </span>
                </ng-template>
            </ngx-datatable-column>


			<ngx-datatable-column name="active">
                <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value" let-row="row">
                    <span>
                        <button class="btn btn-sm" [ngClass]="{'btn-danger': !value, 'btn-secondary': value}" (click)="updateValue(!value, 'active', rowIndex)">
							<span *ngIf="value"><fa-icon [icon]="'check'" class="mr-2"></fa-icon> Active</span>
							<span *ngIf="!value">Not active</span>
                        </button>
                    </span>
                </ng-template>
            </ngx-datatable-column>

			<ngx-datatable-column
				[width]="100"
				[frozenRight]="true"
				[canAutoResize]="false"
			style="position: relative; z-index: 1;">
				<ng-template let-row="row" let-expanded="expanded" ngx-datatable-cell-template let-rowIndex="rowIndex">
					<div ngbDropdown placement="left" class="d-inline-block">
						<button class="btn btn-outline-primary" id="dropdownBasic1" ngbDropdownToggle>
							<fa-icon [icon]="'ellipsis-v'"></fa-icon>
						</button>
						<div ngbDropdownMenu aria-labelledby="dropdownBasic1">
							<button class="dropdown-item">view more</button>
						</div>
						<span><fa-icon [icon]="'circle-notch'" [spin]="true" *ngIf="updating[items[rowIndex].id + items[rowIndex].title]"></fa-icon></span>
					</div>
				</ng-template>
			</ngx-datatable-column>


		</ngx-datatable>
	</div>
</div>
